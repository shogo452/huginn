---
import Layout from "../../layouts/Layout.astro";
import { fetchAllFeeds } from "../../lib/feed-fetcher";
import { TagList } from "../../components/TagList";
import keywordsData from "../../data/keywords.json";

const feeds = await fetchAllFeeds();

// タグごとの記事数を集計
const tagCounts = new Map<string, number>();
for (const item of feeds) {
  for (const tag of item.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  }
}

// 記事数で降順ソート
const sortedTags = [...tagCounts.entries()]
  .sort((a, b) => b[1] - a[1])
  .map(([name, count]) => ({ name, count }));

const baseUrl = import.meta.env.BASE_URL;
const keywordNames = keywordsData.keywords.map((k) => k.name);
---

<Layout title="タグ一覧 - Huginn" description="技術記事のタグ一覧。React、TypeScript、Python、AIなど技術カテゴリ別に記事を閲覧できます。" currentPage="tags">
  <TagList client:load tags={sortedTags} baseUrl={baseUrl} keywordNames={keywordNames} />
</Layout>
